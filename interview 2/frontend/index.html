<!doctype html>
<html><head><meta charset="utf-8"><title>Recipes App</title>
<style>body{font-family:Arial;padding:16px}table{border-collapse:collapse;width:100%}th,td{padding:8px;border:1px solid #ddd;text-align:left}tr:hover{background:#f6f6f6;cursor:pointer}#detail{position:fixed;right:0;top:0;width:420px;height:100%;background:#fff;border-left:1px solid #ddd;padding:16px;overflow:auto;display:none}.controls{display:flex;gap:8px;align-items:center}</style>
</head><body>
<h2>Recipes App</h2>
<div class="controls">
<input id="q_title" placeholder="Title contains..."><input id="q_cuisine" placeholder="Cuisine..."><input id="q_rating" placeholder="rating (e.g. gte:4.5)"><button onclick="search()">Search</button><button onclick="load(1)">Reset</button>
</div>
<div id="meta"></div><table><thead><tr><th>Title</th><th>Cuisine</th><th>Rating</th><th>Total Time</th><th>Serves</th></tr></thead><tbody id="tbody"></tbody></table>
<div style="margin-top:12px;"><button onclick="prev()">Prev</button><span id="pageInfo"></span><button onclick="next()">Next</button></div><div id="detail"></div>
<script>
async function load(p){p=p||1;const url=new URL('/api/recipes',location.origin);url.searchParams.set('page',p);url.searchParams.set('limit',10);const res=await fetch(url);const j=await res.json();renderList(j);}
function renderList(resp){document.getElementById('tbody').innerHTML='';document.getElementById('meta').innerText='Total: '+resp.total;document.getElementById('pageInfo').innerText='Page '+resp.page+' of '+Math.ceil(resp.total/resp.limit);resp.data.forEach(r=>{const tr=document.createElement('tr');tr.onclick=()=>showDetail(r.id);tr.innerHTML=`<td>${r.title}</td><td>${r.cuisine||''}</td><td>${r.rating||''}</td><td>${r.total_time||''}</td><td>${r.serves||''}</td>`;document.getElementById('tbody').appendChild(tr)})}
async function showDetail(id){const res=await fetch(`/api/recipes/${id}`);const r=await res.json();const d=document.getElementById('detail');d.style.display='block';d.innerHTML=`<h3>${r.title} <small>(${r.cuisine||''})</small></h3><p><strong>Description:</strong> ${r.description||''}</p><p><strong>Total Time:</strong> ${r.total_time||''} <button onclick="toggleTimes(${r.prep_time||0},${r.cook_time||0})">expand</button></p><div id="times" style="display:none"></div><h4>Nutrition</h4><table><tbody>${Object.entries(r.nutrients||{}).map(([k,v])=>`<tr><td>${k}</td><td>${v}</td></tr>`).join('')}</tbody></table><p><strong>Serves:</strong> ${r.serves||''}</p><button onclick="document.getElementById('detail').style.display='none'">Close</button>`}
function toggleTimes(prep,cook){const el=document.getElementById('times');el.style.display=el.style.display==='none'?'block':'none';el.innerHTML=`<p>Prep: ${prep}</p><p>Cook: ${cook}</p>`}
async function search(){const title=document.getElementById('q_title').value;c=document.getElementById('q_cuisine').value;rating=document.getElementById('q_rating').value;const url=new URL('/api/recipes/search',location.origin);if(title)url.searchParams.set('title',title);if(c)url.searchParams.set('cuisine',c);if(rating)url.searchParams.set('rating',rating);url.searchParams.set('page',1);url.searchParams.set('limit',10);const res=await fetch(url);const j=await res.json();renderList(j)}
function prev(){const cur=Number(document.getElementById('pageInfo').innerText.split(' ')[1]||1);if(cur>1)load(cur-1)}function next(){const cur=Number(document.getElementById('pageInfo').innerText.split(' ')[1]||1);load(cur+1)}window.onload=()=>load(1)
</script></body></html>
